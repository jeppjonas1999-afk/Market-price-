<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market Price - Tycoon</title>
    <style>
        body { 
            background: #1a1a1a; color: white; font-family: 'Courier New', monospace; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden;
        }
        #ui-panel { margin-bottom: 10px; font-size: 20px; font-weight: bold; display: flex; gap: 20px; background: #333; padding: 10px; border-radius: 5px; }
        #gold-display { color: #f1c40f; }
        #cost-display { color: #e74c3c; }
        
        #game-container {
            width: 800px; height: 600px; background-color: #4a6741; 
            position: relative; border: 6px solid #333; image-rendering: pixelated; 
        }

        .plot {
            width: 100px; height: 100px; background-color: #5d4037;
            border: 2px dashed #3e2723; position: absolute;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 10px; color: #d7ccc8; text-align: center; z-index: 1;
        }

        /* Drill Styling */
        .drill-machine {
            width: 100px; height: 100px; background-color: #7f8c8d;
            border: 4px solid #333; border-bottom: 10px solid #222;
            display: flex; justify-content: center; align-items: center; font-size: 40px;
        }

        .progress-bar { width: 100px; height: 8px; border: 2px solid #000; background: #333; margin-bottom: 2px; }
        .progress-fill { width: 0%; height: 100%; background: #f1c40f; }

        #player { width: 32px; height: 32px; background-color: #3498db; position: absolute; z-index: 10; border: 2px solid #000; }
        #market-stall {
            width: 300px; height: 40px; background-color: #e67e22;
            position: absolute; top: 520px; left: 250px;
            z-index: 15; border: 4px solid #5d2e0a;
            text-align: center; line-height: 40px; font-weight: bold;
        }

        .crate { width: 20px; height: 20px; background-color: #d35400; border: 2px solid #5d2e0a; position: absolute; z-index: 5; }
        #prompt { position: absolute; bottom: 100px; width: 100%; text-align: center; color: yellow; font-weight: bold; z-index: 20; font-size: 18px; }
    </style>
</head>
<body>

    <div id="ui-panel">
        <div id="gold-display">Gold: $<span id="gold-count">0</span></div>
        <div id="inv-display">Crates: <span id="resource-count">0</span></div>
        <div id="cost-display">Next Drill: $<span id="next-cost">100</span></div>
    </div>
    
    <div id="game-container" id="game-world">
        <div id="market-stall">COUNTER (E to Sell)</div>
        <div id="player"></div>
        <div id="prompt"></div>
    </div>

    <script>
        const container = document.getElementById('game-container');
        const goldText = document.getElementById('gold-count');
        const resourceText = document.getElementById('resource-count');
        const costText = document.getElementById('next-cost');
        const prompt = document.getElementById('prompt');
        const player = document.getElementById('player');

        let posX = 384, posY = 300;
        let gold = 0, inventory = 0, nextDrillCost = 100;
        let keys = {};
        let activeCrates = [];
        let plots = [];

        // Define Plot Positions
        const plotCoords = [
            {t:20, l:350, bought: true}, // Start Drill
            {t:20, l:50}, {t:140, l:50}, {t:260, l:50}, {t:380, l:50},
            {t:20, l:650}, {t:140, l:650}, {t:260, l:650}, {t:380, l:650}
        ];

        function initPlots() {
            plotCoords.forEach((coord, index) => {
                let pDiv = document.createElement('div');
                pDiv.className = 'plot';
                pDiv.style.top = coord.t + "px";
                pDiv.style.left = coord.l + "px";
                pDiv.id = "plot-" + index;
                container.appendChild(pDiv);
                
                let plotObj = {
                    ...coord,
                    id: index,
                    progress: 0,
                    div: pDiv,
                    drillDiv: null
                };
                
                if(coord.bought) createDrill(plotObj);
                plots.push(plotObj);
            });
        }

        function createDrill(plot) {
            plot.bought = true;
            plot.div.innerHTML = ""; // Clear "PLOT X" text
            
            let wrapper = document.createElement('div');
            let bar = document.createElement('div');
            bar.className = 'progress-bar';
            let fill = document.createElement('div');
            fill.className = 'progress-fill';
            let machine = document.createElement('div');
            machine.className = 'drill-machine';
            machine.innerHTML = "⚙️";

            bar.appendChild(fill);
            wrapper.appendChild(bar);
            wrapper.appendChild(machine);
            plot.div.appendChild(wrapper);
            plot.fillDiv = fill;
        }

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        window.addEventListener('keypress', e => {
            const key = e.key.toLowerCase();
            if (key === 'e') {
                // Sell
                if (posY > 480) {
                    gold += inventory * 10;
                    inventory = 0;
                    updateUI();
                }
                // Pickup
                activeCrates.forEach((c, i) => {
                    if (getDist(posX, posY, parseInt(c.style.left), parseInt(c.style.top)) < 50) {
                        inventory++;
                        c.remove();
                        activeCrates.splice(i, 1);
                        updateUI();
                    }
                });
            }
            if (key === 'e') {
                plots.forEach(p => {
                    if (!p.bought && getDist(posX, posY, p.l, p.t) < 80) {
                        if (gold >= nextDrillCost) {
                            gold -= nextDrillCost;
                            nextDrillCost *= 10;
                            createDrill(p);
                            updateUI();
                        }
                    }
                });
            }
        });

        function updateUI() {
            goldText.innerText = gold;
            resourceText.innerText = inventory;
            costText.innerText = nextDrillCost;
        }

        function getDist(x1, y1, x2, y2) { return Math.sqrt((x1-x2)**2 + (y1-y2)**2); }

        function gameLoop() {
            // 1. Drill Logic
            plots.forEach(p => {
                if (p.bought) {
                    p.progress += 0.2;
                    if (p.progress >= 100) {
                        p.progress = 0;
                        spawnCrate(p.l, p.t);
                    }
                    p.fillDiv.style.width = p.progress + "%";
                }
            });

            // 2. Movement & Collision
            let nX = posX, nY = posY;
            if (keys['w']) nY -= 5; if (keys['s']) nY += 5;
            if (keys['a']) nX -= 5; if (keys['d']) nX += 5;

            let col = false;
            // Screen & Stall
            if (nX < 0 || nX > 768 || nY < 0 || nY > 480) col = true;
            // Solid Drills
            plots.forEach(p => {
                if (p.bought && nX < p.l + 90 && nX + 32 > p.l && nY < p.t + 90 && nY + 32 > p.t) col = true;
            });

            if (!col) { posX = nX; posY = nY; }
            player.style.left = posX + "px"; player.style.top = posY + "px";

            // 3. Prompts
            let currentPrompt = "";
            if (posY > 480) currentPrompt = "PRESS E TO SELL";
            plots.forEach(p => {
                if (!p.bought && getDist(posX, posY, p.l, p.t) < 80) {
                    currentPrompt = gold >= nextDrillCost ? "PRESS B TO BUY DRILL ($" + nextDrillCost + ")" : "NEED $" + nextDrillCost;
                }
            });
            prompt.innerText = currentPrompt;

            requestAnimationFrame(gameLoop);
        }

        function spawnCrate(x, y) {
            const c = document.createElement('div');
            c.className = 'crate';
            c.style.left = (x + 40) + "px";
            c.style.top = (y + 110) + "px";
            container.appendChild(c);
            activeCrates.push(c);
        }

        initPlots();
        gameLoop();
    </script>
</body>
</html>
