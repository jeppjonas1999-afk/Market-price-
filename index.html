<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Price</title>
    <style>
        body { 
            background: #1a1a1a; color: white; font-family: 'Courier New', monospace; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden;
        }
        
        #game-container {
            width: 600px; height: 500px; background-color: #4a6741; 
            position: relative; border: 6px solid #333; image-rendering: pixelated; 
        }

        #ui-panel { margin-bottom: 10px; font-size: 20px; font-weight: bold; }

        /* The Drill */
        #drill-container {
            position: absolute; top: 20px; left: 250px;
            display: flex; flex-direction: column; align-items: center;
        }

        #progress-wrapper {
            width: 100px; height: 12px; border: 2px solid #000; background: #333; margin-bottom: 5px;
        }

        #progress-fill { width: 0%; height: 100%; background: #f1c40f; }

        #the-drill {
            width: 100px; height: 100px; background-color: #7f8c8d;
            border: 4px solid #333; border-bottom: 12px solid #222;
            display: flex; justify-content: center; align-items: center; font-size: 40px;
        }

        /* The Resource Crate */
        .crate {
            width: 25px; height: 25px; background-color: #d35400;
            border: 2px solid #5d2e0a; position: absolute;
            z-index: 4; display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; color: #5d2e0a;
        }

        /* Player & Stall */
        #player {
            width: 32px; height: 32px; background-color: #3498db; 
            position: absolute; z-index: 5; border: 2px solid #000;
        }

        #market-stall {
            width: 250px; height: 40px; background-color: #e67e22;
            position: absolute; top: 380px; left: 175px;
            z-index: 10; border: 4px solid #5d2e0a;
            text-align: center; line-height: 40px; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="ui-panel">Inventory: <span id="resource-count">0</span></div>
    
    <div id="game-container" id="game-container">
        <div id="drill-container">
            <div id="progress-wrapper"><div id="progress-fill"></div></div>
            <div id="the-drill">⚙️</div>
        </div>
        <div id="market-stall">COUNTER</div>
        <div id="player"></div>
    </div>

    <p><b>WASD</b>: Move | <b>SPACE</b>: Boost Drill | <b>E</b>: Pick up Crate</p>

    <script>
        const player = document.getElementById('player');
        const container = document.getElementById('game-container');
        const progressFill = document.getElementById('progress-fill');
        const resourceText = document.getElementById('resource-count');

        let posX = 284; let posY = 200;
        let inventory = 0;
        let drillProgress = 0;
        let activeCrates = []; 
        const speed = 5;
        const keys = {};

        window.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            keys[key] = true;

            if (e.code === "Space") boostDrill();
            if (key === "e") tryPickUp();
        });
        window.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

        function boostDrill() {
            if (getDistance(posX, posY, 250, 20) < 150) {
                drillProgress += 10;
                if (drillProgress > 100) drillProgress = 100;
            }
        }

        function tryPickUp() {
            activeCrates.forEach((crate, index) => {
                const crateRect = crate.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                const cX = crateRect.left - containerRect.left;
                const cY = crateRect.top - containerRect.top;

                if (getDistance(posX, posY, cX, cY) < 60) {
                    inventory++;
                    resourceText.innerText = inventory;
                    crate.remove();
                    activeCrates.splice(index, 1);
                }
            });
        }

        function spawnCrate() {
            const crate = document.createElement('div');
            crate.className = 'crate';
            crate.innerText = "■";
            // Spawn crate near the bottom of the drill
            crate.style.left = (250 + Math.random() * 70) + "px";
            crate.style.top = "130px";
            container.appendChild(crate);
            activeCrates.push(crate);
        }

        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);
        }

        function gameLoop() {
            // Drill logic
            if (drillProgress < 100) {
                drillProgress += 0.15;
            } else {
                drillProgress = 0;
                spawnCrate();
            }
            progressFill.style.width = drillProgress + "%";

            // Movement
            let nextX = posX; let nextY = posY;
            if (keys['w']) nextY -= speed;
            if (keys['s']) nextY += speed;
            if (keys['a']) nextX -= speed;
            if (keys['d']) nextX += speed;

            // Boundaries
            if (nextX < 0) nextX = 0;
            if (nextY < 0) nextY = 0;
            if (nextX > 568) nextX = 568;
            if (nextY > 348) nextY = 348;

            posX = nextX; posY = nextY;
            player.style.transform = `translate(${posX}px, ${posY}px)`;

            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
