<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market Price</title>
    <style>
        body { 
            background: #1a1a1a; color: white; font-family: 'Courier New', monospace; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden;
        }
        #ui-panel { margin-bottom: 10px; font-size: 22px; font-weight: bold; color: #f1c40f; }
        
        #game-container {
            width: 600px; height: 500px; background-color: #4a6741; 
            position: relative; border: 6px solid #333; image-rendering: pixelated; 
        }

        /* The Drill */
        #drill-container {
            position: absolute; top: 20px; left: 250px;
            width: 100px; height: 120px; /* Defined height for collision */
            display: flex; flex-direction: column; align-items: center;
        }
        #progress-wrapper {
            width: 100px; height: 15px; border: 2px solid #000; background: #333; margin-bottom: 5px;
        }
        #progress-fill { width: 0%; height: 100%; background: #f1c40f; }
        #the-drill {
            width: 100px; height: 100px; background-color: #7f8c8d;
            border: 4px solid #333; border-bottom: 10px solid #222;
            display: flex; justify-content: center; align-items: center; font-size: 40px;
        }

        #player {
            width: 32px; height: 32px; background-color: #3498db; 
            position: absolute; z-index: 5; border: 2px solid #000;
        }

        #market-stall {
            width: 250px; height: 40px; background-color: #e67e22;
            position: absolute; top: 400px; left: 175px;
            z-index: 10; border: 4px solid #5d2e0a;
            text-align: center; line-height: 40px; font-weight: bold;
        }

        .crate { width: 24px; height: 24px; background-color: #d35400; border: 2px solid #5d2e0a; position: absolute; }
        #prompt { position: absolute; bottom: 80px; width: 100%; text-align: center; color: yellow; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="ui-panel">Inventory: <span id="resource-count">0</span></div>
    
    <div id="game-container" id="game-view">
        <div id="drill-container">
            <div id="progress-wrapper"><div id="progress-fill"></div></div>
            <div id="the-drill">⚙️</div>
        </div>
        <div id="market-stall">COUNTER</div>
        <div id="player"></div>
        <div id="prompt">PRESS E TO PICK UP</div>
    </div>

    <script>
        const player = document.getElementById('player');
        const progressFill = document.getElementById('progress-fill');
        const resourceText = document.getElementById('resource-count');
        const prompt = document.getElementById('prompt');
        const container = document.getElementById('game-container');

        let posX = 284, posY = 250;
        let inventory = 0, drillProgress = 0;
        let activeCrates = [];
        const speed = 4;
        const keys = {};

        window.addEventListener('keydown', (e) => { keys[e.key.toLowerCase()] = true; });
        window.addEventListener('keyup', (e) => { keys[e.key.toLowerCase()] = false; });

        // Logic for interaction keys (E and Space)
        window.addEventListener('keypress', (e) => {
            if (e.code === "Space") {
                if (getDist(posX, posY, 250, 60) < 120) drillProgress = Math.min(100, drillProgress + 10);
            }
            if (e.key.toLowerCase() === "e") {
                activeCrates.forEach((crate, i) => {
                    if (getDist(posX, posY, parseInt(crate.style.left), parseInt(crate.style.top)) < 50) {
                        inventory++;
                        resourceText.innerText = inventory;
                        crate.remove();
                        activeCrates.splice(i, 1);
                    }
                });
            }
        });

        function getDist(x1, y1, x2, y2) { return Math.sqrt((x1-x2)**2 + (y1-y2)**2); }

        function gameLoop() {
            // 1. Drill Progress
            if (drillProgress < 100) {
                drillProgress += 0.15;
            } else {
                drillProgress = 0;
                spawnCrate();
            }
            progressFill.style.width = drillProgress + "%";

            // 2. Movement Logic
            let nextX = posX;
            let nextY = posY;
            if (keys['w']) nextY -= speed;
            if (keys['s']) nextY += speed;
            if (keys['a']) nextX -= speed;
            if (keys['d']) nextX += speed;

            // 3. COLLISION BOX
